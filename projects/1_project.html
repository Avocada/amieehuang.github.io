<!doctype html>
<html lang="">
  <!-- Head -->
  <head>
    
    <!-- Metadata, OpenGraph and Schema.org -->




<!-- Standard metadata -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>
  
  
    
      RWE from Longitudinal EHR | Feiqing (Amiee) Huang
    
  
</title>
<meta name="author" content=" ">
<meta
  name="description"
  content="A reproducible pipeline for disease outcomes, imputation, and calibrated causal analysis"
>








<!-- Bootstrap (local) -->
<link rel="stylesheet" href="/assets/css/bootstrap.min.css">

<!-- OPTIONAL: MDB (local) -->
<link rel="stylesheet" href="/assets/css/mdb.min.css">

<!-- Main theme CSS -->
<link rel="stylesheet" href="/assets/css/main.css?v=1757103707">

<!-- Syntax highlighting (light) -->
<link
  rel="stylesheet"
  href="/assets/css/jekyll-pygments-themes-github.css"
  id="highlight_theme_light"
>

<link rel="canonical" href="https://avocada.github.io/projects/1_project.html">


  <!-- Dark Mode -->
  <script src="/assets/js/theme.js?v=1757103707"></script>
  <link
    rel="stylesheet"
    href="/assets/css/jekyll-pygments-themes-native.css"
    media="none"
    id="highlight_theme_dark"
  >
  <script>
    initTheme();
  </script>


<!-- Favicon -->


  </head>

  <!-- Body -->
  <body class="fixed-top-nav ">
    <!-- Header -->
    <header>
  <!-- Nav Bar -->
  <nav
    id="navbar"
    class="navbar navbar-light navbar-expand-sm fixed-top"
    role="navigation"
  >
    <div class="container">
      
        <a class="navbar-brand title font-weight-lighter" href="/">
          Feiqing (Amiee) Huang
        </a>
      
      <!-- Navbar Toggle -->
      <button
        class="navbar-toggler collapsed ml-auto"
        type="button"
        data-toggle="collapse"
        data-target="#navbarNav"
        aria-controls="navbarNav"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar top-bar"></span>
        <span class="icon-bar middle-bar"></span>
        <span class="icon-bar bottom-bar"></span>
      </button>

      <div class="collapse navbar-collapse text-right" id="navbarNav">
        <ul class="navbar-nav ml-auto flex-nowrap">
          

          <!-- About -->
          <li class="nav-item ">
            <a class="nav-link" href="/">about
              
            </a>
          </li>

          <!-- Other pages -->
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
                
                <li class="nav-item ">
                  <a class="nav-link" href="/publications/">publications
                    
                  </a>
                </li>
              
            
          
            
              
                
                <li class="nav-item ">
                  <a class="nav-link" href="/blog/">blog
                    
                  </a>
                </li>
              
            
          
            
              
                
                <li class="nav-item active">
                  <a class="nav-link" href="/projects/">projects
                    
                      <span class="sr-only">(current)</span>
                    
                  </a>
                </li>
              
            
          
          
            <!-- Search -->
            <li class="nav-item">
              <button id="search-toggle" title="Search" onclick="openSearchModal()">
                <span class="nav-link">ctrl k <i class="ti ti-search"></i></span>
              </button>
            </li>
          
          
            <!-- Toogle theme mode -->
            <li class="toggle-container">
              <button id="light-toggle" title="Change theme">
                <i class="ti ti-sun-moon" id="light-toggle-system"></i>
                <i class="ti ti-moon-filled" id="light-toggle-dark"></i>
                <i class="ti ti-sun-filled" id="light-toggle-light"></i>
              </button>
            </li>
          
        </ul>
      </div>
    </div>
  </nav>
  
    <!-- Scrolling Progress Bar -->
    <progress id="progress" value="0">
      <div class="progress-container">
        <span class="progress-bar"></span>
      </div>
    </progress>
  
</header>


    <!-- Content -->
    <div class="container mt-5" role="main">
      
        

<div class="post">
  <header class="post-header">
    <h1 class="post-title">RWE from Longitudinal EHR</h1>
    <p class="post-description">A reproducible pipeline for disease outcomes, imputation, and calibrated causal analysis</p>
  </header>

  <article>
    <blockquote>
  <p>A practical, end-to-end workflow to turn routine EHR data into <strong>reliable real-world evidence (RWE)</strong> for chronic diseases—illustrated with a Multiple Sclerosis (MS) case study comparing high-efficacy DMTs.</p>
</blockquote>

<hr />

<h2 id="why-this-project">Why this project?</h2>

<p>Randomized trials rarely capture long-term effectiveness in diverse, real-world populations. Yet EHRs do—if we can (1) curate data well, (2) recover missing longitudinal outcomes, and (3) correct bias when those outcomes are imperfect.<br />
This project packages a <strong>three-step pipeline</strong> that does exactly that:</p>

<ol>
  <li><strong>Data curation</strong> of structured + unstructured EHR.</li>
  <li><strong>Label-efficient phenotyping</strong> of longitudinal outcomes (e.g., relapse) with semi-/weak-supervision.</li>
  <li><strong>Calibrated causal analysis</strong> so treatment effect (ATE) estimates remain unbiased even when outcomes are imputed.</li>
</ol>

<hr />

<h2 id="pipeline-at-a-glance">Pipeline at a glance</h2>

<div class="row justify-content-center project-fig">
  <div class="col-xl-11 col-lg-12 col-md-13">
    



<figure>
  <picture>
    <!-- Auto scaling with imagemagick -->
    <!--
      See https://www.debugbear.com/blog/responsive-images#w-descriptors-and-the-sizes-attribute and
      https://developer.mozilla.org/en-US/docs/Learn/HTML/Multimedia_and_embedding/Responsive_images for info on defining 'sizes' for responsive images
    -->
    
    <img src="/assets/img/project1/flowchart.png" class="img-fluid w-100 rounded z-depth-1" width="100%" height="auto" title="Overall pipeline" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();" />
  </picture>

  
</figure>

  </div>
</div>

<hr />

<h2 id="1-curate-analysis-ready-ehr">1) Curate analysis-ready EHR</h2>

<ul>
  <li><strong>Standardize structured data</strong>: diagnoses (PheCode), procedures (CCS), meds (RxNorm), labs (LOINC).</li>
  <li><strong>Extract unstructured data</strong>: clinical note concepts (UMLS CUIs) via NLP (e.g., NILE / MetaMap / cTAKES).</li>
  <li><strong>Knowledge-graph feature selection</strong>: start from tools like <strong>ONCE / KESER / ARCH</strong> to assemble disease-relevant features; augment with clinician-suggested terms to avoid omissions.</li>
  <li><strong>Cohort identification</strong>: replace brittle ICD-only filters with weakly/semi-supervised phenotyping (e.g., MAP, PheCAP, APHRODITE).</li>
</ul>

<div class="row justify-content-center project-fig">
  <div class="col-xl-11 col-lg-12 col-md-13">
    



<figure>
  <picture>
    <!-- Auto scaling with imagemagick -->
    <!--
      See https://www.debugbear.com/blog/responsive-images#w-descriptors-and-the-sizes-attribute and
      https://developer.mozilla.org/en-US/docs/Learn/HTML/Multimedia_and_embedding/Responsive_images for info on defining 'sizes' for responsive images
    -->
    
    <img src="/assets/img/project1/once_app.png" class="img-fluid w-100 rounded z-depth-1" width="100%" height="auto" title="ONCE feature explorer" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();" />
  </picture>

  
</figure>

  </div>
</div>
<div class="caption">
  Knowledge-guided feature selection via ONCE app <a class="citation" href="#xiong2025_kmaps">(Xiong et al., 2025)</a>.
</div>

<hr />

<h2 id="2-phenotype-longitudinal-outcomes-label-efficient">2) Phenotype longitudinal outcomes (label-efficient)</h2>

<p>We impute outcomes on a <strong>patient-period grid</strong> (e.g., 3-month windows), combining:</p>

<ul>
  <li>a small set of <strong>gold-standard labels</strong> (registry or curated chart review),</li>
  <li><strong>silver-standard surrogates</strong> available for all (codes, key NLP terms, treatment events),</li>
  <li>and <strong>knowledge-graph embeddings</strong> of features.</li>
</ul>

<p><strong>LATTE</strong> (label-efficient incident phenotyping) <a class="citation" href="#wen2024_latte">(Wen et al., 2024)</a> stacks four modules:</p>

<ul>
  <li><strong>Concept Re-weighting (CR)</strong> — boosts semantically related features.</li>
  <li><strong>Patient-Periods Attention Network (PPAN)</strong> — prioritizes informative periods.</li>
  <li><strong>Bi-GRU sequential model</strong> — captures temporal dependencies.</li>
  <li><strong>Dual-loss training</strong> — pre-train on silver labels, then semi-supervised fine-tuning with gold labels.</li>
</ul>

<div class="row justify-content-center project-fig">
  <div class="col-xl-11 col-lg-12 col-md-13">
    



<figure>
  <picture>
    <!-- Auto scaling with imagemagick -->
    <!--
      See https://www.debugbear.com/blog/responsive-images#w-descriptors-and-the-sizes-attribute and
      https://developer.mozilla.org/en-US/docs/Learn/HTML/Multimedia_and_embedding/Responsive_images for info on defining 'sizes' for responsive images
    -->
    
    <img src="/assets/img/project1/latte_workflow.png" class="img-fluid w-100 rounded z-depth-1" width="100%" height="auto" title="LATTE workflow" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();" />
  </picture>

  
</figure>

  </div>
</div>
<div class="caption">
  LATTE: label-efficient phenotyping for sparse, longitudinal outcomes.
</div>

<hr />

<h2 id="3-calibrated-causal-analysis">3) Calibrated causal analysis</h2>

<p>Using imputed outcomes directly can bias ATE if errors differ by treatment or confounders. We therefore:</p>

<ol>
  <li>Fit <strong>propensity score (PS)</strong> and <strong>outcome regression (OR)</strong> models (doubly robust base).</li>
  <li><strong>Calibrate</strong> imputed outcomes using the gold-labeled subset, regressing true outcomes on treatment, confounders, and imputed values to reduce residual error correlations <a class="citation" href="#cheng2021_ss_ate">(Cheng et al., 2021)</a>.</li>
  <li>Compute <strong>calibrated ATE</strong>, correcting the doubly robust estimator by the estimated bias over labeled data.</li>
</ol>

<hr />

<h2 id="case-study-multiple-sclerosis-ms">Case study: Multiple Sclerosis (MS)</h2>

<p><strong>Question.</strong> Compare 1-year relapse under <strong>B-cell depletion</strong> vs <strong>natalizumab</strong> (first-line high-efficacy DMTs).<br />
<strong>Outcome.</strong> 3-month relapse status (binary) imputed per period, then <strong>rolling-aggregated</strong> to 1-year relapse.<br />
<strong>Highlights.</strong></p>

<ul>
  <li>Knowledge-graph-guided features + registry gold labels.</li>
  <li>LATTE outperformed common ML baselines; <strong>AUC ≈ 0.79</strong> (vs. Lasso ~0.73, RF ~0.76, XGBoost ~0.74).</li>
  <li><strong>Ensembling</strong> LATTE + baselines improved to <strong>AUC ≈ 0.81</strong>.</li>
  <li>Calibrated ATE used gold labels to correct residual bias in imputed outcomes.</li>
</ul>

<hr />

<h2 id="try-it--resources">Try it / resources</h2>

<ul>
  <li><strong>Tutorial website &amp; example code</strong>: <a href="https://celehs.github.io/rwe-tutorial/">https://celehs.github.io/rwe-tutorial/</a></li>
  <li>Methods referenced: LATTE (label-efficient phenotyping), weak/semisupervised phenotyping (MAP/PheCAP/etc.), ONCE feature explorer, calibrated ATE (double-robust + outcome calibration).</li>
</ul>

<hr />

<h2 id="implementation-notes">Implementation notes</h2>

<ul>
  <li><strong>Data schema</strong>: patient-period table (features, demographics, silver label, gold label, label indicator).</li>
  <li><strong>Training</strong>: silver-label pretraining → semi-supervised fine-tuning; cross-fitting for ensembles.</li>
  <li><strong>Causal step</strong>: PS + OR via penalized models or ML; calibrate outcomes on labeled subset; compute bias-corrected ATE.</li>
  <li><strong>Scale</strong>: for ~5k patients, ~100k periods, ~100 features, LATTE training ≈ hours on CPU (parallelization/batching recommended).</li>
</ul>

  </article>

  
    <h2>References</h2>
    <div class="publications">
      
        <none class="bibliography"><li><div class="pub">
  <div class="pub-cite">
    Xiong, Xin and Sweet, Sara Morini and Liu, Molei and Hong, Chuan and Bonzel, Clara-Lea and Panickan, Vidul A. and Zhou, Doudou and Wang, Linshanshan and Costa, Lauren and Ho, Yuk-Lam and Geva, Alon and Mandl, Kenneth D. and Cheng, Su-Chun and Xia, Zongqi and Cho, Kelly and Gaziano, J. Michael and Liao, Katherine P. and Cai, Tianxi and Cai, Tianrun

     (2025).
    
      <a class="pub-title" href="https://doi.org/10.1101/2023.09.29.23296239">Knowledge-Driven Online Multimodal Automated Phenotyping System</a>.
    
    <span class="pub-venue"><em>medRxiv</em>, 2023.09.29.23296239</span>
    <span class="pub-actions"><a href="https://doi.org/10.1101/2023.09.29.23296239"><i class="fas fa-link"></i> DOI</a></span>
  </div>
</div>
</li>
<li><div class="pub">
  <div class="pub-cite">
    <strong>Huang, Feiqing</strong> and Hou, Jue and Zhou, Ningxuan and Greco, Kimberly and Lin, Chenyu and Sweet, Sara Morini and Wen, Jun and Shen, Lechen and Gonzalez, Nicolas and Zhang, Sinian and Liao, Katherine P. and Cai, Tianxi and Xia, Zongqi and Bourgeois, Florence T. and Cai, Tianrun

     (2025).
    
      <a class="pub-title" href="https://doi.org/10.2196/71873">Advancing the Use of Longitudinal Electronic Health Records: Tutorial for Uncovering Real-World Evidence in Chronic Disease Outcomes</a>.
    
    <span class="pub-venue"><em>Journal of Medical Internet Research</em>, <strong>27</strong>, e71873</span>
    <span class="pub-actions"><a href="https://doi.org/10.2196/71873"><i class="fas fa-link"></i> DOI</a></span>
  </div>
</div>
</li>
<li><div class="pub">
  <div class="pub-cite">
    Wen, Jun and Hou, Jue and Bonzel, Clara-Lea and Zhao, Yihan and Castro, Victor M. and Gainer, Vivian S. and Weisenfeld, Dana and Cai, Tianrun and Ho, Yuk-Lam and Panickan, Vidul A. and Costa, Lauren and Hong, Chuan and Gaziano, J. Michael and Liao, Katherine P. and Lu, Junwei and Cho, Kelly and Cai, Tianxi

     (2024).
    
      <a class="pub-title" href="https://doi.org/10.1016/j.patter.2023.100906">LATTE: Label-efficient incident phenotyping from longitudinal electronic health records</a>.
    
    <span class="pub-venue"><em>Patterns</em>, <strong>5</strong>(1), 100906</span>
    <span class="pub-actions"><a href="https://doi.org/10.1016/j.patter.2023.100906"><i class="fas fa-link"></i> DOI</a></span>
  </div>
</div>
</li>
<li><div class="pub">
  <div class="pub-cite">
    Cheng, David and Ananthakrishnan, Ashwin N. and Cai, Tianxi

     (2021).
    
      <a class="pub-title" href="https://doi.org/10.1111/biom.13298">Robust and efficient semi-supervised estimation of average treatment effects with application to electronic health records data</a>.
    
    <span class="pub-venue"><em>Biometrics</em>, <strong>77</strong>(2), 413–423</span>
    <span class="pub-actions"><a href="https://doi.org/10.1111/biom.13298"><i class="fas fa-link"></i> DOI</a></span>
  </div>
</div>
</li></none>
      
    </div>
  

  
</div>

      
    </div>

    <!-- Footer -->
    


  <footer class="fixed-bottom" role="contentinfo">
    <div class="container mt-0">
      
  &copy; Copyright 2025
  
  
  . 
  
  

    </div>
  </footer>



    <!-- JavaScripts -->
    <!-- jQuery -->
<script
  src=""
  integrity=""
  crossorigin="anonymous"
></script>

<!-- Bootsrap & MDB scripts -->
<script src="/assets/js/bootstrap.bundle.min.js"></script>
<script
  src=""
  integrity=""
  crossorigin="anonymous"
></script>


  <!-- Masonry & imagesLoaded -->
  <script
    defer
    src=""
    integrity=""
    crossorigin="anonymous"
  ></script>
  <script
    defer
    src=""
    integrity=""
    crossorigin="anonymous"
  ></script>
  <script defer src="/assets/js/masonry.js" type="text/javascript"></script>























  <!-- Medium Zoom JS -->
  <script
    defer
    src=""
    integrity=""
    crossorigin="anonymous"
  ></script>
  <script defer src="/assets/js/zoom.js"></script>






<!-- Load Common JS -->
<script src="/assets/js/no_defer.js"></script>
<script defer src="/assets/js/common.js"></script>
<script defer src="/assets/js/copy_code.js" type="text/javascript"></script>

<!-- Jupyter Open External Links New Tab -->
<script defer src="/assets/js/jupyter_new_tab.js"></script>

<!-- Badges -->












  <!-- Scrolling Progress Bar -->
  <script
    defer
    src="/assets/js/progress-bar.js"
    type="text/javascript"
  ></script>









  <!-- Search -->
  <script type="module" src="/assets/js/search/ninja-keys.min.js"></script>
  <ninja-keys hideBreadcrumbs noAutoLoadMdIcons placeholder="Type to start searching"></ninja-keys>
  <script src="/assets/js/search-setup.js"></script>
  <script src="/assets/js/search-data.js"></script>
  <script src="/assets/js/shortcut-key.js"></script>




  </body>
</html>
